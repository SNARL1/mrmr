<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to mrmr • mrmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to mrmr">
<meta property="og:description" content="mrmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mrmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-to-mrmr.html">An introduction to mrmr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro-to-mrmr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to mrmr</h1>
            
      
      
      <div class="hidden name"><code>intro-to-mrmr.Rmd</code></div>

    </div>

    
    
<p>The <code>mrmr</code> package is designed to simplify and expedite mark recapture data processing, parameter estimation, and visualization for a narrow class of mark recapture data (namely, those collected by the Sierra Nevada Amphibian Research Group).</p>
<div id="workflow-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#workflow-overview" class="anchor"></a>Workflow overview</h1>
<p>The typical workflow involves three steps:</p>
<ol style="list-style-type: decimal">
<li>Cleaning mark recapture data with <code><a href="../reference/clean_data.html">mrmr::clean_data()</a></code>
</li>
<li>Fitting a mark recapture model with <code><a href="../reference/fit_model.html">mrmr::fit_model()</a></code>
</li>
<li>Visualizing results with <code><a href="../reference/plot_model.html">mrmr::plot_model()</a></code>
</li>
</ol>
<div id="data-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#data-specifications" class="anchor"></a>Data specifications</h2>
<p>The package comes with example data that illustrate the expected format. Three files are needed.</p>
<p>The first file specifies capture data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan">rstan</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: StanHeaders</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; rstan (Version 2.21.2, GitRev: 2e1f913d3ca3)</span>
<span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span>
<span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span>
<span class="co">#&gt; rstan_options(auto_write = TRUE)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mrmr</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">captures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                                <span class="st">"capture-example.csv"</span>, 
                                package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span>
<span class="co">#&gt; Rows: 466 Columns: 19</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr  (9): swab_id, surveyor1, pit_tag_status, frog_sex, frog_state, swabber_...</span>
<span class="co">#&gt; dbl  (7): pit_tag_id, site_id, frog_weight, frog_svl, collection_location, r...</span>
<span class="co">#&gt; date (3): survey_date, collection_date, release_date</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">captures</span><span class="op">)</span>
<span class="co">#&gt; Rows: 466</span>
<span class="co">#&gt; Columns: 19</span>
<span class="co">#&gt; $ swab_id             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ pit_tag_id          &lt;dbl&gt; 9.00043e+14, 9.00043e+14, 9.00043e+14, 9.00043e+14…</span>
<span class="co">#&gt; $ site_id             &lt;dbl&gt; 70449, 70449, 70449, 70449, 70449, 70449, 70449, 7…</span>
<span class="co">#&gt; $ survey_date         &lt;date&gt; 2014-08-07, 2015-08-16, 2014-07-11, 2015-08-15, 2…</span>
<span class="co">#&gt; $ surveyor1           &lt;chr&gt; "Killion", "Killion", "Demaranville", "Lindauer", …</span>
<span class="co">#&gt; $ pit_tag_status      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ frog_sex            &lt;chr&gt; "M", "F", "M", "M", "F", "F", "M", "M", "F", "F", …</span>
<span class="co">#&gt; $ frog_state          &lt;chr&gt; "Healthy", "Healthy", "Healthy", "Healthy", "Healt…</span>
<span class="co">#&gt; $ frog_weight         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ frog_svl            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ swabber_name        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ treatment           &lt;chr&gt; "unexposed", "exposed", "unexposed", "unexposed", …</span>
<span class="co">#&gt; $ collection_date     &lt;date&gt; 2014-06-27, 2014-06-23, 2014-06-27, 2014-06-27, 2…</span>
<span class="co">#&gt; $ collection_location &lt;dbl&gt; 72996, 72996, 72996, 72996, 72996, 72996, 72996, 7…</span>
<span class="co">#&gt; $ release_location    &lt;dbl&gt; 70449, 70449, 70449, 70449, 70449, 70449, 70449, 7…</span>
<span class="co">#&gt; $ release_date        &lt;date&gt; 2014-06-28, 2014-06-28, 2014-06-28, 2014-06-28, 2…</span>
<span class="co">#&gt; $ standard_type       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ load                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">#&gt; $ category            &lt;chr&gt; "translocated", "translocated", "translocated", "t…</span></code></pre></div>
<p>Note that the <code>system.file</code> function generates a path to the <code>capture-example.csv</code> file, but in a real application, you would likely use a path to a local file (real data, not the example data included in the package). The files must be formatted with the same columns and conventions uesd in the example data. Each row in this file represents a capture or recapture event.</p>
<p>The second file specifies translocation data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">translocations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                                      <span class="st">"translocation-example.csv"</span>, 
                                      package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span>
<span class="co">#&gt; Rows: 80 Columns: 17</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr  (9): swab_id, treatment, pit_tag_status, frog_sex, frog_state, frog_loc...</span>
<span class="co">#&gt; dbl  (6): pit_tag_id, frog_weight, frog_svl, quant_cycle, start_quant, load</span>
<span class="co">#&gt; date (2): release_date, swabbing_date</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">translocations</span><span class="op">)</span>
<span class="co">#&gt; Rows: 80</span>
<span class="co">#&gt; Columns: 17</span>
<span class="co">#&gt; $ swab_id        &lt;chr&gt; "RKS16752", "RKS16755", "RKS16756", "RKS16757", "RKS167…</span>
<span class="co">#&gt; $ pit_tag_id     &lt;dbl&gt; 9.00043e+14, 9.00043e+14, 9.00043e+14, 9.00043e+14, 9.0…</span>
<span class="co">#&gt; $ treatment      &lt;chr&gt; "exposed", "exposed", "exposed", "exposed", "exposed", …</span>
<span class="co">#&gt; $ release_date   &lt;date&gt; 2014-06-28, 2014-06-28, 2014-06-28, 2014-06-28, 2014-0…</span>
<span class="co">#&gt; $ swabbing_date  &lt;date&gt; 2014-06-23, 2014-06-23, 2014-06-23, 2014-06-23, 2014-0…</span>
<span class="co">#&gt; $ pit_tag_status &lt;chr&gt; "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", "Y", …</span>
<span class="co">#&gt; $ frog_sex       &lt;chr&gt; "F", "F", "M", "M", "M", "F", "F", "F", "M", "F", "F", …</span>
<span class="co">#&gt; $ frog_state     &lt;chr&gt; "Healthy", "Healthy", "Healthy", "Healthy", "Healthy", …</span>
<span class="co">#&gt; $ frog_location  &lt;chr&gt; "in lake", "in lake", "in lake", "in lake", "in lake", …</span>
<span class="co">#&gt; $ frog_weight    &lt;dbl&gt; 11, 13, 12, 10, 10, 10, 11, 13, 13, 11, 10, 11, 11, 10,…</span>
<span class="co">#&gt; $ frog_svl       &lt;dbl&gt; 46, 51, 44, 42, 44, 40, 45, 48, 49, 47, 48, 47, 46, 44,…</span>
<span class="co">#&gt; $ swabber_name   &lt;chr&gt; "Kauffman", "Kauffman", "Kauffman", "Kauffman", "Kauffm…</span>
<span class="co">#&gt; $ frog_comments  &lt;chr&gt; "Treated, for translocation to 70449.", "Treated, for t…</span>
<span class="co">#&gt; $ quant_cycle    &lt;dbl&gt; 35.72, 26.40, 28.51, 34.27, 36.12, 28.55, 31.44, 27.37,…</span>
<span class="co">#&gt; $ start_quant    &lt;dbl&gt; 0.09, 51.65, 12.33, 0.25, 0.07, 12.03, 1.68, 26.74, 0.4…</span>
<span class="co">#&gt; $ standard_type  &lt;chr&gt; "genomic", "genomic", "genomic", "genomic", "genomic", …</span>
<span class="co">#&gt; $ load           &lt;dbl&gt; 432, 247920, 59184, 1200, 336, 57744, 8064, 128352, 196…</span></code></pre></div>
<p>Each row corresponds to a translocation event of one unique individual.</p>
<p>The third file specifies survey-level data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                               <span class="st">"survey-example.csv"</span>, 
                                package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span>
<span class="co">#&gt; Rows: 51 Columns: 4</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; dbl  (3): primary_period, secondary_period, survey_duration</span>
<span class="co">#&gt; date (1): survey_date</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span>
<span class="co">#&gt; Rows: 51</span>
<span class="co">#&gt; Columns: 4</span>
<span class="co">#&gt; $ survey_date      &lt;date&gt; 2014-06-28, 2014-07-10, 2014-07-11, 2014-07-12, 2014…</span>
<span class="co">#&gt; $ primary_period   &lt;dbl&gt; 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7,…</span>
<span class="co">#&gt; $ secondary_period &lt;dbl&gt; 0, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2,…</span>
<span class="co">#&gt; $ survey_duration  &lt;dbl&gt; 0.00, 7.61, 7.00, 5.35, 7.33, 7.58, 8.16, 7.58, 7.85,…</span></code></pre></div>
<p>Here, each row is a unique survey.</p>
</div>
<div id="data-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#data-processing" class="anchor"></a>Data processing</h2>
<p>To load and process the data, provide paths to the data files as arguments to the <code><a href="../reference/clean_data.html">mrmr::clean_data()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">surveys</span>, <span class="va">translocations</span><span class="op">)</span></code></pre></div>
<p>The output provides data frames as list elements, and a list element called <code>stan_d</code>, which contains data that has been pre-processed for model fitting.</p>
<div id="including-detectionnon-detection-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#including-detectionnon-detection-covariates" class="anchor"></a>Including detection/non-detection covariates</h3>
<p>Survey-level covariates that might affect the probability of detection can be included via the <code>capture_formula</code> argument to <code>clean_data</code>. <strong>Note:</strong> it is a good idea to ensure that any continuous covariates are rescaled prior to using them as covariates to have mean = 0 and unit standard deviation. This can be acheived by adding a column to the <code>captures</code> data Using a covariate value like <code>year</code>, which typically has a mean in the thousands and a standard deviation far from one will almost assurredly result in numerical issues when fitting a model.</p>
<p>Assuming we wanted to include a covariate for detection like <code>person_hours</code>, we can do so as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># center and scale the covariate</span>
<span class="va">captures</span> <span class="op">&lt;-</span> <span class="va">captures</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>c_person_hours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">person_hours</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># specify the formula</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">surveys</span>, <span class="va">translocations</span>,
                   capture_formula <span class="op">=</span> <span class="op">~</span> <span class="va">c_person_hours</span><span class="op">)</span></code></pre></div>
</div>
<div id="including-survival-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#including-survival-covariates" class="anchor"></a>Including survival covariates</h3>
<p>Individual-level survival covariates can be included optionally via the <code>survival_formula</code> and <code>survival_fill_value</code> arguments. Both of these must be specified, because covariate values for pseudo-individuals must be filled in (they are never observed). So, for example, to evaluate the effect of an experimental treatment, if some individuals belong to a “treatment” group and others belong to an “control” group, then a group must be specified as a fill value (e.g., “wild-caught” or “control”, depending on the experiment):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify the formula</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">surveys</span>, <span class="va">translocations</span>,
                   survival_formula <span class="op">=</span> <span class="op">~</span> <span class="va">treatment</span>, 
                   survival_fill_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="st">"wild-caught"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="model-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#model-structure" class="anchor"></a>Model structure</h2>
<p>The <code>mrmr</code> package implements a Bayesian open-population Jolly-Seber mark recapture model with known additions to the population (introduced adults). The model tracks the states of <span class="math inline">\(M\)</span> individuals that comprise a superpopulation made up of real and pseudo-individuals (see Joseph and Knapp 2018, <em>Ecosphere</em> for details).</p>
<p>We assume a robust sampling design where the states of individuals are constant within primary periods, which have repeat secondary periods within them (during which observations are made). The possible states of individuals include “not recruited”, “alive”, and “dead”. The possible observations of individuals include “detected” and “not detected”. We assume that individuals that are in the “not recruited” or “dead” states are never detected (i.e., there are no mistakes in the individual PIT tag ID records).</p>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>To fit a mark-recapture model, use <code><a href="../reference/fit_model.html">mrmr::fit_model()</a></code>. This model accounts for known introductions into the population, and has random effects to account for variation in survival and recruitment through time. The example below uses two chains and relatively few iterations for speed, but it is a good idea to run 3+ chains, and at least 1000 iterations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data</span>, cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span>, 
                 chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></code></pre></div>
<p>To diagnose potential non-convergence of the MCMC algorithm, inspect traceplots:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'alpha_lambda'</span>, 
                  <span class="st">'sigma_lambda'</span>, 
                  <span class="st">'beta_phi'</span>, 
                  <span class="st">'sigma_phi'</span>, 
                  <span class="st">'beta_detect'</span><span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">m_fit</span>, pars <span class="op">=</span> <span class="va">pars_to_plot</span><span class="op">)</span></code></pre></div>
<p><img src="intro-to-mrmr_files/figure-html/plot-traceplots-1.png" width="672"></p>
<p>It is also a good idea to look at Rhat estimates to see whether they indicate of a lack of convergence (Rhat values <span class="math inline">\(\geq\)</span> 1.01):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">m_fit</span>, pars <span class="op">=</span> <span class="va">pars_to_plot</span><span class="op">)</span>
<span class="co">#&gt; Inference for Stan model: twostate.</span>
<span class="co">#&gt; 2 chains, each with iter=200; warmup=100; thin=1; </span>
<span class="co">#&gt; post-warmup draws per chain=100, total post-warmup draws=200.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                 mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat</span>
<span class="co">#&gt; alpha_lambda   -4.89    0.06 0.56 -5.81 -5.26 -4.96 -4.56 -3.79   100 0.99</span>
<span class="co">#&gt; sigma_lambda    1.98    0.05 0.58  1.14  1.55  1.87  2.35  3.26   135 1.01</span>
<span class="co">#&gt; beta_phi[1]     1.72    0.03 0.35  0.98  1.52  1.72  1.95  2.43   106 1.01</span>
<span class="co">#&gt; sigma_phi       1.17    0.05 0.42  0.55  0.86  1.13  1.42  2.02    83 1.01</span>
<span class="co">#&gt; beta_detect[1] -0.39    0.00 0.07 -0.52 -0.43 -0.40 -0.35 -0.26   222 1.00</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Tue Aug 17 21:21:23 2021.</span>
<span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="co">#&gt; convergence, Rhat=1).</span></code></pre></div>
</div>
<div id="built-in-visualizations" class="section level2">
<h2 class="hasAnchor">
<a href="#built-in-visualizations" class="anchor"></a>Built-in visualizations</h2>
<p>Time series of abundance, recruitment, and survival of introduced cohorts are available through the <code><a href="../reference/plot_model.html">mrmr::plot_model()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_model.html">plot_model</a></span><span class="op">(</span><span class="va">mod</span>, what <span class="op">=</span> <span class="st">'abundance'</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "primary_period"</span></code></pre></div>
<p><img src="intro-to-mrmr_files/figure-html/plot-abundance-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_model.html">plot_model</a></span><span class="op">(</span><span class="va">mod</span>, what <span class="op">=</span> <span class="st">'recruitment'</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "primary_period"</span></code></pre></div>
<p><img src="intro-to-mrmr_files/figure-html/plot-recruitment-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_model.html">plot_model</a></span><span class="op">(</span><span class="va">mod</span>, what <span class="op">=</span> <span class="st">'survival'</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "pit_tag_id"</span>
<span class="co">#&gt; Joining, by = "primary_period"</span></code></pre></div>
<p><img src="intro-to-mrmr_files/figure-html/plot-survival-1.png" width="672"></p>
<div id="translocation-survival-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#translocation-survival-tables" class="anchor"></a>Translocation survival tables</h3>
<p>If individuals have been translocated into sites, you can generate a table of estimated survival through time for each cohort (release date) as a function of years since introduction:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/survival_table.html">survival_table</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "pit_tag_id"</span>
<span class="co">#&gt; Joining, by = "primary_period"</span>
<span class="co">#&gt; # A tibble: 7 × 5</span>
<span class="co">#&gt;   years_since_introduction release_date lo_survival median_survival hi_survival</span>
<span class="co">#&gt;                      &lt;dbl&gt; &lt;date&gt;             &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1                        0 2014-06-28        0.6             0.627       0.673 </span>
<span class="co">#&gt; 2                        0 2017-08-09        0.867           0.933       1     </span>
<span class="co">#&gt; 3                        1 2014-06-28        0.347           0.353       0.374 </span>
<span class="co">#&gt; 4                        1 2017-08-09        0.500           0.55        0.667 </span>
<span class="co">#&gt; 5                        2 2014-06-28        0.17            0.175       0.19  </span>
<span class="co">#&gt; 6                        3 2014-06-28        0.0867          0.0933      0.113 </span>
<span class="co">#&gt; 7                        4 2014-06-28        0.07            0.08        0.0903</span></code></pre></div>
<p>You can also get estimates of survival through time by individual or cohort:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/survival_table.html">survival_table</a></span><span class="op">(</span><span class="va">mod</span>, by_cohort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "pit_tag_id"</span>
<span class="co">#&gt; Joining, by = "primary_period"</span>
<span class="co">#&gt; # A tibble: 7 × 5</span>
<span class="co">#&gt;   years_since_introduction release_date lo_survival median_survival hi_survival</span>
<span class="co">#&gt;                      &lt;dbl&gt; &lt;date&gt;             &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1                        0 2014-06-28        0.6             0.627       0.673 </span>
<span class="co">#&gt; 2                        0 2017-08-09        0.867           0.933       1     </span>
<span class="co">#&gt; 3                        1 2014-06-28        0.347           0.353       0.374 </span>
<span class="co">#&gt; 4                        1 2017-08-09        0.500           0.55        0.667 </span>
<span class="co">#&gt; 5                        2 2014-06-28        0.17            0.175       0.19  </span>
<span class="co">#&gt; 6                        3 2014-06-28        0.0867          0.0933      0.113 </span>
<span class="co">#&gt; 7                        4 2014-06-28        0.07            0.08        0.0903</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/survival_table.html">survival_table</a></span><span class="op">(</span><span class="va">mod</span>, by_individual <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "pit_tag_id"</span>
<span class="co">#&gt; Joining, by = "primary_period"</span>
<span class="co">#&gt; # A tibble: 310 × 6</span>
<span class="co">#&gt;    years_since_introduction release_date pit_tag_id      lo_survival median_survival</span>
<span class="co">#&gt;                       &lt;dbl&gt; &lt;date&gt;       &lt;chr&gt;                 &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1                        0 2014-06-28   900043000104502       1               1    </span>
<span class="co">#&gt;  2                        0 2014-06-28   900043000104505       1               1    </span>
<span class="co">#&gt;  3                        0 2014-06-28   900043000104510       1               1    </span>
<span class="co">#&gt;  4                        0 2014-06-28   900043000104512       0.333           0.333</span>
<span class="co">#&gt;  5                        0 2014-06-28   900043000104513       0               0    </span>
<span class="co">#&gt;  6                        0 2014-06-28   900043000104516       0.333           0.333</span>
<span class="co">#&gt;  7                        0 2014-06-28   900043000104520       0               0    </span>
<span class="co">#&gt;  8                        0 2014-06-28   900043000104521       0.333           0.333</span>
<span class="co">#&gt;  9                        0 2014-06-28   900043000104522       1               1    </span>
<span class="co">#&gt; 10                        0 2014-06-28   900043000104524       1               1    </span>
<span class="co">#&gt; # … with 300 more rows, and 1 more variable: hi_survival &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="custom-visualizations" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-visualizations" class="anchor"></a>Custom visualizations</h2>
<p>Any of the plotting functionality that you would expect from a <code>stanfit</code> model is available as well, by accessing the <code>m_fit</code> list element from a model object. For example, we could assess the posterior for the superpopulation size:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">m_fit</span>, pars <span class="op">=</span> <span class="st">"Nsuper"</span><span class="op">)</span></code></pre></div>
<p><img src="intro-to-mrmr_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="cases-with-no-translocations" class="section level2">
<h2 class="hasAnchor">
<a href="#cases-with-no-translocations" class="anchor"></a>Cases with no translocations</h2>
<p>In some cases, there may not be any introductions of animals into a population. The only difference in implementation in such cases is that the <code>translocations</code> argument to <code><a href="../reference/clean_data.html">clean_data()</a></code> can be omitted:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_no_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">surveys</span><span class="op">)</span>
<span class="va">mod_no_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data_no_trans</span><span class="op">)</span></code></pre></div>
</div>
<div id="cases-with-known-removals" class="section level2">
<h2 class="hasAnchor">
<a href="#cases-with-known-removals" class="anchor"></a>Cases with known removals</h2>
<p>When individuals are removed from a population, e.g., for translocation, these known removals can be included as data to increase the precision of abundance estimates. An example dataset fitting this case is included at an imaginary site called “Equid”. Note below that we filter out dead animals – any dead animals encountered on surveys should be in the <code>removals</code> data, and not in the <code>captures</code> data frame, which should only contain live animals (those that might survive to the next primary period).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">captures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                        <span class="st">"equid-captures.csv"</span>, 
                         package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">capture_animal_state</span> <span class="op">!=</span> <span class="st">'dead'</span><span class="op">)</span>
<span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                       <span class="st">"equid-surveys.csv"</span>, 
                       package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span>
<span class="va">removals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, 
                        <span class="st">"equid-removals.csv"</span>, 
                         package <span class="op">=</span> <span class="st">"mrmr"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">read_csv</span>

<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span><span class="op">(</span><span class="va">captures</span>, <span class="va">surveys</span>, removals <span class="op">=</span> <span class="va">removals</span><span class="op">)</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">d</span>, cores <span class="op">=</span> <span class="fl">2</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Max Joseph.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
